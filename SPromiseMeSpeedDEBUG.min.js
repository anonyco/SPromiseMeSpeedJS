'use strict';(function(L){function C(c){c()}function D(c){c(this)}function F(){if(v){do q=!1,A.shift()();while(--v)}q=!1}function y(c,k,d){this.then=c;this["catch"]=k;this["finally"]=d}function r(c){function k(a){0===h&&(E(a)?a.then(k,d):(g=a,h=2,null!==e&&("function"===typeof e?e(a):e.forEach(D,a),e=null),b=null,null!==l&&("function"===typeof l?l():l.forEach(C),l=null)))}function d(a){0===h&&(g=a,h=1,null!==b&&("function"===typeof b?b(a):b.forEach(D,a),b=null),e=null,null!==l&&("function"===typeof l?
l():l.forEach(C),l=null))}var g,h=0,e=null,b=null,l=null,f=new y(function(a,m){void 0!=a&&"function"!==typeof a&&console.warn(Object.prototype.toString.call(a)+" is not a valid function to be called after a successful promise");void 0!=m&&"function"!==typeof m&&console.warn(Object.prototype.toString.call(m)+" is not a valid function to be called after a rejected promise");if(0===h)return G(function(t,z){var w="function"===typeof a?function(){t(a(g))}:t,H="function"===typeof m?function(){z(m(g))}:
z;null!==e?"function"===typeof e?e=[e,w]:e.push(w):e=w;null!==b?"function"===typeof b?b=[b,H]:b.push(H):b=H});try{return 2===h?"function"===typeof a?B(a(g)):u:"function"===typeof m?p(m(g)):u}catch(t){return p(t)}},function(a){void 0!=a&&"function"!==typeof a&&console.warn(Object.prototype.toString.call(a)+" is not a valid function to be called after a rejected promise");if(0===h)return G(function(m){null!==b?"function"===typeof b?b=[b,function(){m(a(g))}]:b.push(function(){m(a(g))}):b=function(){m(a(g))};
null!==e?"function"===typeof e?e=[e,m]:e.push(m):e=m});if(2===h)return B(g);try{return"function"===typeof a?B(a(g)):u}catch(m){return p(m)}},function(a){void 0!=a&&"function"!==typeof a&&console.warn(Object.prototype.toString.call(a)+" is not a valid function to be called 'finally' after promise");if(0===h)null!==l?"function"===typeof l?l=[l,a]:l.push(a):l=a;else try{a()}catch(m){return p(m)}return f});if(!0===q)A.push(function(){try{c(k,d)}catch(a){d(a)}}),v=v+1|0;else{n=n+1|0;if(q=128===n)try{c(k,
d)}catch(a){d(a)}else{try{c(k,d)}catch(a){d(a)}!0===q&&1===n&&F()}n=n-1|0}return f}function G(c){function k(f){0===g&&(d=f,g=1,null!==e&&("function"===typeof e?e(f):e.forEach(D,f),e=null),h=null,null!==b&&("function"===typeof b?b():b.forEach(C),b=null))}var d,g=0,h=null,e=null,b=null,l=new y(function(f,a){f&&"function"!==typeof f&&console.error(Object.prototype.toString.call(f)+" is not a valid function to be called after a successful promise");a&&"function"!==typeof a&&console.error(Object.prototype.toString.call(a)+
" is not a valid function to be called after a rejected promise");if(0===g)return r(function(m,t){var z="function"===typeof f?function(){m(f(d))}:m,w="function"===typeof a?function(){t(a(d))}:t;null!==h?"function"===typeof h?h=[h,z]:h.push(z):h=z;null!==e?"function"===typeof e?e=[e,w]:e.push(w):e=w});try{return 2===g?"function"===typeof f?x(f(d)):u:"function"===typeof a?p(a(d)):u}catch(m){return p(m)}},function(f){f&&"function"!==typeof f&&console.error(Object.prototype.toString.call(f)+" is not a valid function to be called after a rejected promise");
if(0===g)return r(function(a){null!==e?"function"===typeof e?e=[e,function(){a(f(d))}]:e.push(function(){a(f(d))}):e=function(){a(f(d))};null!==h?"function"===typeof h?h=[h,a]:h.push(a):h=a});if(2===g)return x(d);try{return"function"===typeof f?x(f(d)):u}catch(a){return p(a)}},function(f){"function"!==typeof f&&console.error(Object.prototype.toString.call(f)+" is not a valid function to be called 'finally' after promise");0===g?null!==b?"function"===typeof b?b=[b,f]:b.push(f):b=f:f();return l});try{c(function m(a){0===
g&&(E(a)?a.then(m,k):(d=a,g=2,null!==h&&("function"===typeof h?h(a):h.forEach(D,a),h=null),null!==b&&("function"===typeof b?b():b.forEach(C),b=null),e=null))},k)}catch(f){k(f)}return l}function x(c){if("object"===typeof c&&null!==c&&"function"===typeof c.then)return c;var k=new y(function(d){if("function"!==typeof d)return k;if(!0===q)return G(function(h,e){A.push(function(){try{h(d(c))}catch(b){e(b)}});v=v+1|0});n=n+1|0;var g=null;try{(q=128===n)?A.push(function(){d(c)}):(g=d(c),!0===q&&1===n&&F())}catch(h){return p(h)}finally{n=
n-1|0}return B(g)},function(){return k},function(d){if("function"===typeof d)if(!0===q)A.push(d),v=v+1|0;else{n=n+1|0;try{(q=128===n)?(d(),q=!1):(d(),!0===q&&1===n&&F())}catch(g){return p(g)}finally{n=n-1|0}}return k});return k}function B(c){if("object"===typeof c&&null!==c&&"function"===typeof c.then)return c;var k=new y(function(d){try{return"function"===typeof d?x(d(c)):u}catch(g){return p(g)}},function(){return k},function(d){try{"function"===typeof d&&d()}catch(g){return p(g)}return k});return k}
function p(c){if("object"===typeof c&&null!==c&&"function"===typeof c.then)return c;var k=new y(function(d,g){try{return"function"===typeof g?x(g(c)):u}catch(h){return p(h)}},function(d){try{return"function"===typeof d?x(d(c)):u}catch(g){return p(g)}},function(d){try{"function"===typeof d&&d()}catch(g){return p(g)}return k});return k}function I(c,k){if("object"!==typeof c||"function"!==typeof c.forEach)return console.error(Object.prototype.toString.call(c)+" is not a valid iterable array of promises. If you are using an array-like object, you must call Array.prototype.slice.call on the object before passing it to SPromise."+
k),u}const A=[],E=r.isPromise=function(c){return"object"===typeof c&&null!==c&&"function"===typeof c.then};var n=0,q=!1,v=0,J="undefined"!==typeof Symbol&&Symbol.toStringTag,u=x();"symbol"===typeof J&&(y.prototype[J]="Promise");r.resolve=B;r.reject=p;var K=!1;r.race=function(c){I(c,"race");K||c.length||(K=!0,console.warn(Object.prototype.toString.call(c)+" is an empty array of promises passed to SPromise"));return r(function(k,d){function g(f){e&&(e=0,k(f))}function h(f){e&&(e=0,d(f))}for(var e=1,
b=0,l;b<c.length&&e;b=b+1|0)E(l=c[b])?l.then(g,h):g(l)})};r.all=function(c){I(c,"all");return r(function(k,d){function g(m){a.then(function(t){l[m|0]=t;b=b-1|0;0===b&&k(l)},function(t){0<b&&(b=-1,d(t))})}for(var h=null,e=c.length|0,b=e,l=[],f=0,a;f<e;f=f+1|0)E(a=c[f])?(l[f]=h,g(f)):(b=b-1|0,l[f]=h=a);0===b&&k(l)})};"undefined"!==typeof module?module.exports=r:L.SPromise=r})("undefined"===typeof self?this||global:self);
